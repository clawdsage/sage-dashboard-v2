(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{99855:function(e,t,n){Promise.resolve().then(n.bind(n,80669))},80669:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return X}});var r=n(57437),s=n(64671),a=n.n(s);n(53054);var i=n(87138),c=n(16463),l=n(11005),o=n(11240),u=n(91863),d=n(38711),m=n(94207),x=n(15862),h=n(51077),g=n(49354),b=n(649);let f=[{name:"Dashboard",href:"/",icon:l.Z},{name:"Agents",href:"/agents",icon:o.Z},{name:"Projects",href:"/projects",icon:u.Z},{name:"Analytics",href:"/analytics",icon:d.Z},{name:"Activity",href:"/activity",icon:m.Z},{name:"Review",href:"/review",icon:x.Z}];function p(e){let{pendingReviewCount:t=0,activeAgentCount:n=0,todayCost:s=0}=e,a=(0,c.usePathname)();return(0,r.jsxs)("div",{className:"w-60 bg-bg-secondary border-r border-border-subtle flex flex-col",children:[(0,r.jsxs)("div",{className:"p-6 border-b border-border-subtle",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-accent-blue",children:"Sage"}),(0,r.jsx)("p",{className:"text-sm text-text-muted",children:"Dashboard V2"})]}),(0,r.jsx)("nav",{className:"flex-1 p-4 space-y-2",children:f.map(e=>{let n=a===e.href,s="Review"===e.name&&t>0;return(0,r.jsxs)(i.default,{href:e.href,className:(0,g.cn)("flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors relative",n?"bg-accent-blue text-white":"text-text-secondary hover:bg-bg-tertiary hover:text-text-primary"),children:[(0,r.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name,s&&(0,r.jsx)(b.C,{variant:"danger",className:"ml-auto text-xs px-1.5 py-0.5 h-5 min-w-5 flex items-center justify-center",children:t})]},e.name)})}),(0,r.jsxs)("div",{className:"p-4 border-t border-border-subtle space-y-3",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-text-secondary",children:"Quick Stats"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(m.Z,{className:"mr-2 h-4 w-4 text-accent-green"}),"Active"]}),(0,r.jsx)("span",{className:"font-medium",children:n})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(h.Z,{className:"mr-2 h-4 w-4 text-accent-amber"}),"Today"]}),(0,r.jsxs)("span",{className:"font-medium",children:["$",s.toFixed(2)]})]})]})]})]})}var v=n(79869),w=n(7746),y=n(35690),j=n(92699),N=n(22757),_=n(75733),O=n(68954),k=n(54817),S=n(6600),Z=n(52022),q=n(2265),I=n(44316),C=n(47390);function D(e){let{count:t,onClick:n}=e;return 0===t?null:(0,r.jsxs)("button",{onClick:n,className:"relative p-2 rounded-md hover:bg-bg-tertiary transition-colors",title:"".concat(t," pending ticket").concat(1===t?"":"s"),children:[(0,r.jsx)(C.Z,{className:"h-5 w-5"}),(0,r.jsx)(b.C,{variant:"warning",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center text-xs animate-pulse ".concat(t>9?"px-1":""),children:t>99?"99+":t})]})}let F={thinking:(0,r.jsx)(v.Z,{className:"w-4 h-4"}),coding:(0,r.jsx)(w.Z,{className:"w-4 h-4"}),writing:(0,r.jsx)(y.Z,{className:"w-4 h-4"}),idle:(0,r.jsx)(j.Z,{className:"w-4 h-4"}),spawning:(0,r.jsx)(N.Z,{className:"w-4 h-4"}),reviewing:(0,r.jsx)(_.Z,{className:"w-4 h-4"})},Q={thinking:"bg-purple-500/20 text-purple-400 border-purple-500/30",coding:"bg-blue-500/20 text-blue-400 border-blue-500/30",writing:"bg-green-500/20 text-green-400 border-green-500/30",idle:"bg-gray-500/20 text-gray-400 border-gray-500/30",spawning:"bg-cyan-500/20 text-cyan-400 border-cyan-500/30",reviewing:"bg-pink-500/20 text-pink-400 border-pink-500/30"};function A(e){let t=e.match(/^\S+\s*(\w+):/),n=t?t[1].toLowerCase():"idle",r=e.match(/:\s*([^|]+)/);return{status:n,description:r?r[1].trim():"Standing by"}}function T(){let[e,t]=(0,q.useState)(null),[n]=(0,q.useState)(3);return(0,q.useEffect)(()=>{(async()=>{let{data:e}=await I.O.from("subagent_runs").select("task_description").eq("name","sage-main-status").single();(null==e?void 0:e.task_description)&&t(A(e.task_description))})();let e=I.O.channel("sage-header-status").on("postgres_changes",{event:"UPDATE",schema:"public",table:"subagent_runs",filter:"name=eq.sage-main-status"},e=>{var n;(null===(n=e.new)||void 0===n?void 0:n.task_description)&&t(A(e.new.task_description))}).subscribe();return()=>{I.O.removeChannel(e)}},[]),(0,r.jsx)("header",{className:"bg-bg-secondary border-b border-border-subtle px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center space-x-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full border ".concat(e?Q[e.status]||Q.idle:"bg-bg-tertiary border-border-subtle"),children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),(0,r.jsx)("div",{className:"absolute inset-0 w-2 h-2 bg-green-400 rounded-full animate-ping opacity-50"})]}),(0,r.jsx)(O.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"font-medium text-sm",children:"Sage"}),e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-text-muted",children:"â€¢"}),F[e.status]||(0,r.jsx)(j.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-sm capitalize",children:e.status})]})]})}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(k.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-muted"}),(0,r.jsx)("input",{type:"text",placeholder:"Search...",className:"pl-10 pr-4 py-2 bg-bg-tertiary border border-border-subtle rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-accent-blue focus:border-transparent"})]}),(0,r.jsx)(i.default,{href:"/review",children:(0,r.jsx)(D,{count:n})}),(0,r.jsxs)("button",{className:"p-2 rounded-md hover:bg-bg-tertiary transition-colors relative",children:[(0,r.jsx)(S.Z,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"absolute -top-1 -right-1 h-3 w-3 bg-accent-red rounded-full text-xs flex items-center justify-center",children:"2"})]}),(0,r.jsxs)("button",{className:"flex items-center space-x-2 p-2 rounded-md hover:bg-bg-tertiary transition-colors",children:[(0,r.jsx)("div",{className:"h-8 w-8 bg-accent-blue rounded-full flex items-center justify-center",children:(0,r.jsx)(Z.Z,{className:"h-4 w-4 text-white"})}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Tim"})]})]})]})})}var K=n(58421),L=n(93191);let E=new K.S({defaultOptions:{queries:{staleTime:3e5,refetchOnWindowFocus:!1}}});function M(e){let{children:t}=e;return(0,r.jsx)(L.aH,{client:E,children:t})}var P=n(33814),R=n(54904),J=n(76351);function z(e){let{children:t}=e,{agents:n}=(0,R.P)(),{reviews:s}=(0,P.k)(),a=n.filter(e=>"active"===e.status).length,{data:i=0}=(0,J.a)({queryKey:["todayCost"],queryFn:async()=>{let e=new Date().toISOString().split("T")[0],{data:t,error:n}=await I.O.from("subagent_runs").select("cost").gte("started_at",e).lt("started_at",new Date(new Date(e).getTime()+864e5).toISOString());if(n)throw n;return t.reduce((e,t)=>e+t.cost,0)}});return(0,r.jsxs)("div",{className:"flex h-screen",children:[(0,r.jsx)(p,{pendingReviewCount:s.length,activeAgentCount:a,todayCost:i}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,r.jsx)(T,{}),(0,r.jsx)("main",{className:"flex-1 overflow-auto",children:t})]})]})}function X(e){let{children:t}=e;return(0,r.jsx)("html",{lang:"en",className:"dark",children:(0,r.jsx)("body",{className:"".concat(a().className," bg-bg-primary text-text-primary min-h-screen"),children:(0,r.jsx)(M,{children:(0,r.jsx)(z,{children:t})})})})}},649:function(e,t,n){"use strict";n.d(t,{C:function(){return c}});var r=n(57437),s=n(13027),a=n(49354);let i=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-accent-blue text-white hover:bg-accent-blue/80",secondary:"border-transparent bg-bg-tertiary text-text-primary hover:bg-bg-tertiary/80",outline:"text-text-primary",success:"border-transparent bg-accent-green text-white hover:bg-accent-green/80",warning:"border-transparent bg-accent-amber text-white hover:bg-accent-amber/80",danger:"border-transparent bg-accent-red text-white hover:bg-accent-red/80"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:n,...s}=e;return(0,r.jsx)("div",{className:(0,a.cn)(i({variant:n}),t),...s})}},54904:function(e,t,n){"use strict";n.d(t,{P:function(){return c}});var r=n(93191),s=n(76351),a=n(2265),i=n(44316);function c(e){let t=(0,r.NL)(),n=(0,s.a)({queryKey:["agents",e],queryFn:async()=>{let t=i.O.from("subagent_runs").select("*").neq("name","sage-main-status").order("started_at",{ascending:!1});e&&(t=t.eq("status",e));let{data:n,error:r}=await t;if(r)throw r;return n}});return(0,a.useEffect)(()=>{let e=i.O.channel("subagent_runs_changes").on("postgres_changes",{event:"*",schema:"public",table:"subagent_runs"},e=>{t.invalidateQueries({queryKey:["agents"]})}).subscribe();return()=>{i.O.removeChannel(e)}},[t]),{agents:n.data||[],isLoading:n.isLoading,error:n.error}}},33814:function(e,t,n){"use strict";n.d(t,{k:function(){return l}});var r=n(93191),s=n(76351),a=n(25524),i=n(2265),c=n(44316);function l(){let e=(0,r.NL)(),t=(0,s.a)({queryKey:["reviewQueue"],queryFn:async()=>{let{data:e,error:t}=await c.O.from("subagent_runs").select("*").eq("review_status","pending").order("completed_at",{ascending:!1});if(t)throw t;return e}});(0,i.useEffect)(()=>{let t=c.O.channel("review_queue_changes").on("postgres_changes",{event:"*",schema:"public",table:"subagent_runs",filter:"review_status=eq.pending"},t=>{e.invalidateQueries({queryKey:["reviewQueue"]})}).subscribe();return()=>{c.O.removeChannel(t)}},[e]);let n=(0,a.D)({mutationFn:async e=>{let{id:t,comment:n}=e,{error:r}=await c.O.from("subagent_runs").update({review_status:"approved",review_comment:n,reviewed_at:new Date().toISOString(),reviewed_by:"user"}).eq("id",t);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["reviewQueue"]})}}),l=(0,a.D)({mutationFn:async e=>{let{id:t,comment:n}=e,{error:r}=await c.O.from("subagent_runs").update({review_status:"rejected",review_comment:n,reviewed_at:new Date().toISOString(),reviewed_by:"user"}).eq("id",t);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["reviewQueue"]})}}),o=(0,a.D)({mutationFn:async e=>{let{error:t}=await c.O.from("subagent_runs").update({review_status:"approved",review_comment:"Bulk approved",reviewed_at:new Date().toISOString(),reviewed_by:"user"}).in("id",e);if(t)throw t},onSuccess:()=>{e.invalidateQueries({queryKey:["reviewQueue"]})}});return{reviews:t.data||[],isLoading:t.isLoading,error:t.error,approveReview:n.mutate,rejectReview:l.mutate,bulkApprove:o.mutate,isApproving:n.isPending,isRejecting:l.isPending,isBulkApproving:o.isPending}}},44316:function(e,t,n){"use strict";n.d(t,{O:function(){return r}});let r=(0,n(17327).eI)("https://kunkqedkkpwaspsucytj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt1bmtxZWRra3B3YXNwc3VjeXRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3Mzg4MTgsImV4cCI6MjA4NTMxNDgxOH0.gLXr1NCOSaLKGySozsDKJucOhtEDrm1OOfmbj7Z7-1o")},49354:function(e,t,n){"use strict";n.d(t,{SY:function(){return c},aF:function(){return l},cn:function(){return a},p6:function(){return i}});var r=n(44839),s=n(96164);function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.m6)((0,r.W)(t))}function i(e){return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(new Date(e))}function c(e){let t=new Date,n=new Date(e),r=Math.floor((t.getTime()-n.getTime())/1e3);return r<60?"just now":r<3600?"".concat(Math.floor(r/60),"m ago"):r<86400?"".concat(Math.floor(r/3600),"h ago"):"".concat(Math.floor(r/86400),"d ago")}function l(e,t){return e.length<=t?e:e.slice(0,t)+"..."}},53054:function(){}},function(e){e.O(0,[93,289,176,734,522,971,23,744],function(){return e(e.s=99855)}),_N_E=e.O()}]);